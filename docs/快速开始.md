# 2DGS 快速开始指南

## 一行命令开始训练

```bash
# 激活环境
conda activate gs_linux_backup

# 进入项目目录
cd ~/projects/2d-gaussian-splatting

# 训练（使用 COLMAP 处理后的数据）
python train.py -s data/my_video/sparse_undistorted -m output/my_video
```

---

## 从自己的视频开始（完整流程）

### 1. 准备视频
```bash
cd ~/projects/2d-gaussian-splatting

# 创建数据目录
mkdir -p data/my_video/images

# 提取视频帧（2 fps，保持宽高比）
ffmpeg -i path/to/your/video.mp4 -vf "fps=2,scale=1920:-2" data/my_video/images/%04d.jpg
```

### 2. COLMAP 处理
```bash
conda activate gs_linux_backup
cd data/my_video

# 特征提取（GPU 加速）
colmap feature_extractor --database_path database.db --image_path images

# 特征匹配（GPU 加速）
colmap exhaustive_matcher --database_path database.db

# 稀疏重建（CPU 密集，需要时间）
colmap mapper --database_path database.db --image_path images --output_path sparse

# 图像去畸变（生成 PINHOLE 相机）
colmap image_undistorter \
    --image_path images \
    --input_path sparse/0 \
    --output_path sparse_undistorted \
    --output_type COLMAP
```

**⚠️ 重要：稀疏重建（mapper）需要 10-30 分钟，主要在 CPU 上运行**

### 3. 训练 2DGS
```bash
cd ~/projects/2d-gaussian-splatting

# 训练
python train.py -s data/my_video/sparse_undistorted -m output/my_video
```

**训练参数：**
- `-s`: 数据集路径
- `-m`: 输出模型路径
- `--iterations`: 默认 30000 次迭代
- `--lambda_normal 0.05`: 法向正则化（提高几何质量）
- `--lambda_distortion 0.01`: 深度畸变正则化

### 4. 渲染和可视化
```bash
# 渲染测试集
python render.py -s data/my_video/sparse_undistorted -m output/my_video

# 实时查看训练过程
python view.py -s data/my_video/sparse_undistorted -m output/my_video
```

---

## 训练进度

训练过程中会显示：
- **进度条**：`Training progress: 23%|██▎`
- **迭代数**：`7000/30000`
- **损失**：`Loss=0.04840`
- **点数**：`Points=1363948`
- **速度**：`3.50it/s`

**预计时间**：~30-60 分钟（30000 次迭代）

---

## 查看训练好的模型

### 方法 1：使用 view.py（推荐）
```bash
python view.py -s data/my_video/sparse_undistorted -m output/my_video
```
- 支持鼠标拖拽旋转
- 实时渲染
- GPU 加速

### 方法 2：使用 SIBR Viewer
```bash
# 1. 启动 SIBR Viewer
<path_to_viewer>/bin/SIBR_remoteGaussian_app_rwdi

# 2. 或者在训练时自动连接
python view.py -s data/my_video/sparse_undistorted -m output/my_video
```

### 方法 3：渲染图片
```bash
# 渲染所有视角
python render.py -s data/my_video/sparse_undistorted -m output/my_video

# 查看渲染结果
ls output/my_video/train/  # 训练集渲染
ls output/my_video/test/   # 测试集渲染
```

---

## 提取网格模型（可选）

### 有界网格（适合室内、前景物体）
```bash
python render.py \
    -s data/my_video/sparse_undistorted \
    -m output/my_video \
    --mesh_res 512 \
    --skip_test --skip_train
```

### 无界网格（适合室外大场景）
```bash
python render.py \
    -s data/my_video/sparse_undistorted \
    -m output/my_video \
    --unbounded \
    --mesh_res 1024 \
    --skip_test --skip_train
```

**输出**：`output/my_video/mesh.ply`

---

## 常见问题

### Q: 训练中断了怎么办？
```bash
# 从断点恢复（如果有的话）
python train.py -s data/my_video/sparse_undistorted -m output/my_video --start_checkpoint output/my_video/chkpnt7000.pth
```

### Q: 如何减少训练时间？
```bash
# 减少迭代次数
python train.py -s data/my_video/sparse_undistorted -m output/my_video --iterations 15000
```

### Q: COLMAP 太慢怎么办？
减少图片数量：
```bash
ffmpeg -i video.mp4 -vf "fps=1,scale=1280:-2" images/%04d.jpg
```

---

## 完整示例（从视频到模型）

```bash
# 1. 激活环境
conda activate gs_linux_backup

# 2. 进入项目
cd ~/projects/2d-gaussian-splatting

# 3. 准备数据
mkdir -p data/my_video/images
ffmpeg -i ~/projects/Sparse2DGS/video.mp4 -vf "fps=2,scale=1920:-2" data/my_video/images/%04d.jpg

# 4. COLMAP 特征提取
cd data/my_video
colmap feature_extractor --database_path database.db --image_path images

# 5. COLMAP 特征匹配
colmap exhaustive_matcher --database_path database.db

# 6. COLMAP 稀疏重建（等待 10-30 分钟）
colmap mapper --database_path database.db --image_path images --output_path sparse

# 7. 图像去畸变
colmap image_undistorter --image_path images --input_path sparse/0 --output_path sparse_undistorted --output_type COLMAP

# 8. 训练 2DGS（回到项目目录）
cd ~/projects/2d-gaussian-splatting
python train.py -s data/my_video/sparse_undistorted -m output/my_video

# 9. 查看模型
python view.py -s data/my_video/sparse_undistorted -m output/my_video
```

**总时间**：30-90 分钟
- COLMAP：10-30 分钟
- 训练：20-60 分钟

---

## 相关文件位置

- **数据**：`~/projects/2d-gaussian-splatting/data/my_video/`
- **模型**：`~/projects/2d-gaussian-splatting/output/my_video/`
- **日志**：`output/my_video/cfg_args`
- **渲染结果**：`output/my_video/train/` 或 `output/my_video/test/`

---

**最后更新**：2026-02-16
**你的 fork**：https://github.com/tianxingleo/2d-gaussian-splatting
